# Created at https://sequencediagram.org/
title MONNAI Informatics Gateway - Export

participant "MIG Export Watcher" as EW
participant "MONAI Workload Manager\nExport API" as EA

participant "MIG FHIR Service" as FHIR
participant "MIG SCU Service" as SCU
database "MIG\nDatabase" as DB
fontawesome f0f8 "Hospital\nInformation Systems" as HIS


activate EW
EW->EA: Query for pending export tasks

alt case DICOM
EW<--EA: Response DICOM Dataset
EW->SCU: Queue DiCOM export task
else case ACR
EW<--EA: Response ACR Request
EW->DB: Query original request for export settings
EW<--DB: Response
EW->SCU: Queue DICOM export task
EW->FHIR: Queue ACR export task
else case FHIR
EW<--EA: Response FHIR Resource
EW->FHIR:Queue ACR export task
end
SCU->DB: Query for destination AET info
SCU<--DB: Response
SCU->HIS: C-STORE-REQ
SCU<--HIS: C-STORE-RSP
SCU->EA: Update export task status
FHIR->DB: Query for FHIR service endpoint
FHIR<--DB: Response
FHIR->HIS: POST /resource/...
FHIR<--HIS: Response
FHIR->EA: Update export task status
